<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PackageProbe</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>

<body>
  <main>
    <h1>Package Probe</h1>
    <h3>upload your package.json to find vulnerabilites in your project</h3>
    <form id="uploadForm" enctype="multipart/form-data">
      <input type="file" name="file" id="fileInput" accept=".json">
      <button type="submit">Upload</button>
    </form>
    <div id="fileData">_> Drag and Drop a package.json file.</div>
  </main>

  <script>
    
    const fileDataDiv = document.getElementById('fileData');
    const socket = new WebSocket('ws://localhost:3000');

    socket.onopen = () => {
        console.log('WebSocket connection established');
      };
      
      socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        console.log('Message from server:', data);
        
        const message = data.replace(/\n/g, '<br>');
        
        fileDataDiv.innerHTML += data;
        
        // Auto-scroll to the bottom
        fileDataDiv.scrollTop = fileDataDiv.scrollHeight;
      };
      
      socket.onclose = () => {
        console.log('WebSocket connection closed');
      };
      
      socket.onerror = (error) => {
        console.error('WebSocket error:', error);
      };
      
      document.getElementById('uploadForm').addEventListener('submit', function (event) {
        event.preventDefault();

        fileDataDiv.innerHTML = ""; //remove the default msg in the fileData box
        
        const formData = new FormData();
        formData.append('file', document.getElementById('fileInput').files[0]);

        fetch('/upload', {
          method: 'POST',
          body: formData,
        })
      });
  </script>
</body>
</html>